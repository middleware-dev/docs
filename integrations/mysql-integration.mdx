---
title: "MySQL"
description: MySQL Integration - Setup & Installation Docs | Middleware
---

The MySQL Integration allows you to ingest and monitor the performance and health metrics of your relational database management system (RDBMS) data. This integration is useful for identifying top SQL operations by row, tallying total requests to MySQL handlers, and tracking worker thread count.

# Prerequisites

Middleware Host Agent (MW Agent) must be installed on your local machine. To install the MW Agent, see our [Installation Guide](https://docs.middleware.io/agent-installation/overview).

# Setup

### Step 1: Create Database Credentials

Create a `.yaml` file containing database credentials like the below example. If the database is not password protected, the `username` and `password` fields can be removed.

`/home/ubuntu/mysql-creds.yaml`

```yaml .yaml
mysql:
    endpoint: localhost:3306
    username: mysql  
    password: mysql 

```
<Note> For Docker users, create the credentials yaml file in the `/var/log` directory. </Note>

### Step 2: Access Integrations

Log in to Middleware, navigate to the Installations Page in the bottom left corner, select All Integration and click MySQL

<img src="/images/integration/mysql-store.png" />

### Step 3: Enable Integration

Add a host machine from the dropdown list, input the credential path from Step 1, and Save

# Visualize Analytics

### Default MySQL Dashboard

Once the MySQL integration setup is complete, a new MySQL-specific dashboard will appear in the Dashboard Builder. This default dashboard serves as a jumping off point for visualizing and analyzing MySQL data. 

<img src="/images/integration/mysql-dashboard.png" />

### Create MySQL Widget

MySQL data can be added to dashboards as a custom widget. When adding a new widget, select the `mysql` data source to view a full list of available MySQL data. 

<img src="/images/integration/mysql-custom-graphs.png" />

# MySQL Non-Root User Metric Collection

MySQL metrics are collected by querying `performance_schema` and `sys_schema` along with status variables that are managed by `mysql-server`. To allow for this collection you must create a non-root user with specific permissions described below.

### Step 1: Create a User

Create a user named `mw` and specify your own unique password with the following command. `mw` will have the ability to login from any host unless otherwise specified.

```
mysql> CREATE USER 'mw'@'%' IDENTIFIED BY '<PASSWORD>';
```

<Note> To specify the specific host that `mw` can log into, change your above user name to the following: `mw@'<hostaddr>'` </Note>

Check if the user was created successfully by running the following command:

```
mysql -u mw --password=<PASSWORD> -e "show status" | \
grep Uptime && echo -e "\033[0;32mMySQL user - OK\033[0m" || \
echo -e "\033[0;31mCannot connect to MySQL\033[0m"
```

If successful, you will see the following output:

```
MySQL user - OK
```

### Step 2: Grant `mw` Permissions:

Grant `mw` permissions by running the following commands:

```
GRANT REPLICATION CLIENT ON *.* TO 'mw'@'%'
```

```
ALTER USER 'mw'@'%' WITH MAX_USER_CONNECTIONS 5;
```

```
GRANT PROCESS ON *.* TO 'mw'@'%';
```

```
GRANT SELECT ON performance_schema.* TO 'mw'@'%';
```

### Step 3: Check New Privelages

Ensure you have properly granted permissions to the `mw` user by running the following commands:

```
mysql -u mw --password=<PASSWORD> -e "show slave status" && \
echo -e "\033[0;32mMySQL grant - OK\033[0m" || \
echo -e "\033[0;31mMissing REPLICATION CLIENT grant\033[0m"
```

# Alerts

Alerts can be configured for any MySQL metrics. When creating a new rule select the Database detection method and MySQL database type for available metrics to appear in the Metrics dropdown list. Select the desired metric and continue configuring the alert conditions.

# Metrics Collected

| __Metric__                               | __Description__                                                                                        |
| ------------------------------------ | -------------------------------------------------------------------------------------------------- |
| `mysql.buffer_pool.pages`            | Number of pages in the InnoDB buffer pool                                                     |
| `mysql.buffer_pool.data_pages`       | Number of data pages in the InnoDB buffer pool                                               |
| `mysql.buffer_pool.page_flushes`     | Number of requests to flush pages from the InnoDB buffer pool                               |
| `mysql.buffer_pool.operations`       | Number of operations on the InnoDB buffer pool                                                |
| `mysql.buffer_pool.limit`            |  Configured size of the InnoDB buffer pool                                                  |
| `mysql.buffer_pool.usage`            |  Number of bytes in the InnoDB buffer pool                                                   |
| `mysql.commands`                     |  Count of commands executed, per command type                           |
| `mysql.prepared_statements`          |  Count of prepared statements executed, per statement type                     |
| `mysql.handlers`                     |   Number of requests to MySQL handlers                                             |
| `mysql.double_writes`                |   Number of writes to the InnoDB doublewrite buffer                                          |
| `mysql.log_operations`               |  Number of InnoDB log operations                                                      |
| `mysql.operations`                   |  Number of InnoDB operations                                                               |
| `mysql.page_operations`              |  Number of InnoDB page operations                                  |
| `mysql.table.io.wait.count`          | Total count of I/O wait events for a table                                       |
| `mysql.table.io.wait.time`           | Total time of I/O wait events for a table                                       |
| `mysql.index.io.wait.count`          | Total count of I/O wait events for an index                                     |
| `mysql.index.io.wait.time`           | Total time of I/O wait events for an index                                      |
| `mysql.row_locks`                    | Number of InnoDB row blocks                                                 |
| `mysql.row_operations`               |  Number of InnoDB row operations                                                    |
| `mysql.locks`                        |  Number of MySQL locks                                                  |
| `mysql.sorts`                        | Number of MySQL sorts                                                              |
| `mysql.threads`                      | State of MySQL threads                                                                |
| `mysql.locked_connects`              | Number of attempts to connect to locked user accounts                                  |
| `mysql.opened_resources`             | Number of opened resources                                                                 |
| `mysql.mysqlx_connections`           | Number of mysqlx connections                                   |
| `mysql.tmp_resources`                | Number of created temporary resources                                       |
| `mysql.table.lock_wait.read.count`   | Count of lock wait read events                                         |
| `mysql.table.lock_wait.read.time`    |  Total lock wait read event time                                       |
| `mysql.table.lock_wait.write.count`  | Count of lock wait write events                            |
| `mysql.table.lock_wait.write.time`   | Total lock wait write event time                                            |
| `mysql.locked_connects`              | Number of attempts to connect to locked user accounts                                 |
| `mysql.connection.count`             | Total number of connection attempts to the MySQL server (includes successful and unsuccessful attempts)                  |
| `mysql.connection.errors`            | Client connection process errors                     |
| `mysql.mysqlx_connections`           | Number of mysqlx connections                                                           |
| `mysql.joins`                        | Number of joins that perform table scans                                                  |
| `mysql.replica.time_behind_source`   | Actual replica delay, in seconds                                       |
| `mysql.replica.sql_delay`            | Configured replica delay, in seconds                                     |
| `mysql.statement_event.count`        | Count of statement events                                          |
| `mysql.statement_event.wait.time`    | Total wait time of summarized timed events                                           |
| `mysql.mysqlx_worker_threads`        | Number of worker threads available                                                    |
| `mysql.table_open_cache`             | Total number of hits, misses, and overflows for open table cache lookups                          |
| `mysql.query.client.count`           | Number of client statements executed by the server   |
| `mysql.query.count`                  | Total number of statements executed by the server                                                   |
| `mysql.query.slow.count`             | Number of slow queries                                                                      |
| `mysql.statement_event.count`        | Summary of current and recent statement events |
| `mysql.statement_event.wait.time`    | The total wait time of the summarized timed events |

# Troubleshooting

<Accordion title="Missing Integrations Menu">
  If you do not see the Integrations Menu in Middlware, that means your account has not been granted `Installation` permissions. Contact your system administrator to add the `Installation` permission to your user role in Settings.
</Accordion>

# Next Steps

- [How to Create Alerts](https://docs.middleware.io/workflow/alerting/setup-alert)
- [Dashboard Basics & Customization](https://docs.middleware.io/workflow/custom-dashboard/dashboard-builder-overview)
- [Custom Telemetry Ingestion](https://docs.middleware.io/open-telemetry/otel-getting-started)
- [Getting Started With Real User Monitoring (RUM)](https://docs.middleware.io/rum/rum-overview)
- [Data Ingestion APIs](https://docs.middleware.io/data-ingestion-apis/opentelemetry-metrics)


<Note> Need assistance or want to learn more about Middleware? Contact us at support[at]middleware.io. </Note>